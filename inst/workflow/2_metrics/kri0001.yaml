meta:
  Type: Analysis
  ID: kri0001
  GroupLevel: Site
  Abbreviation: AE
  Metric: Adverse Event Rate
  Numerator: Adverse Events
  Denominator: Days on Study
  Model: Normal Approximation
  Score: Adjusted Z-Score
  AnalysisType: rate
  Threshold: -2,-1,2,3
  AccrualThreshold: 30
  AccrualMetric: Denominator
spec:
  Mapped_AE:
    subjid:
      type: character
    aest_dt:
      type: Date
  Mapped_SUBJ:
    subjid:
      type: character
    invid:
      type: character
    studyid:
      type: character
  Mapped_Visit:
    subjid:
      type: character
    visit_dt:
      type: Date
steps:
  - output: Analysis_Input
    name: gsm.studykri::Input_CountSiteByMonth
    params:
      dfSubjects: Mapped_SUBJ
      dfNumerator: Mapped_AE
      dfDenominator: Mapped_Visit
      strStudyCol: studyid
      strGroupCol: invid
      strGroupLevel: GroupLevel
      strSubjectCol: subjid
      strNumeratorDateCol: aest_dt
      strDenominatorDateCol: visit_dt
  - output: Analysis_Transformed
    name: gsm.studykri::Transform_CumCount
    params:
      dfInput: Analysis_Input
      vBy: 
        - StudyID
      nMinDenominator: 25
  - output: Analysis_Bootstrapped
    name: gsm.studykri::Analyze_StudyKRI
    params:
      dfInput: Analysis_Input
      nBootstrapReps: 1000
      seed: 42
  - output: Analysis_BootstrappedStudy
    name: gsm.studykri::Transform_CumCount
    params:
      dfInput: Analysis_Bootstrapped
      vBy:
        - StudyID
        - BootstrapRep
      nMinDenominator: 25
  - output: Analysis_Bounds
    name: gsm.studykri::Analyze_StudyKRI_PredictBounds
    params:
      dfInput: Analysis_BootstrappedStudy
      vBy:
        - StudyID
      nConfLevel: 0.95
  - output: Analysis_GroupBounds
    name: gsm.studykri::Analyze_StudyKRI_PredictBoundsGroup
    params:
      dfInput: Analysis_Input
      vStudyFilter: null
      nBootstrapReps: 1000
      nConfLevel: 0.95
      nMinDenominator: 25
      seed: 42
  - output: lAnalysis
    name: list
    params:
      ID: ID
      Analysis_Input: Analysis_Input
      Analysis_Transformed: Analysis_Transformed
      Analysis_Bootstrapped: Analysis_Bootstrapped
      Analysis_BootstrappedStudy: Analysis_BootstrappedStudy
      Analysis_Bounds: Analysis_Bounds
      Analysis_GroupBounds: Analysis_GroupBounds
