meta:
  Type: Analysis
  ID: kri0002
  GroupLevel: Site
  Abbreviation: AE
  Metric: Adverse Event Rate per Days on Study
  Numerator: Adverse Events
  Denominator: Days on Study
  Model: Bootstrap CI
  Score: Bootstrap CI
  AnalysisType: rate
  Threshold: 0.95
  AccrualThreshold: 180
  AccrualMetric: Denominator
  BootstrapReps: 1000
spec:
  Mapped_AE:
    subjid:
      type: character
    aest_dt:
      type: Date
  Mapped_SUBJ:
    subjid:
      type: character
    invid:
      type: character
    studyid:
      type: character
    firstparticipantdate:
      type: Date
    lastparticipantdate:
      type: Date
steps:
  - output: Analysis_Input
    name: gsm.studykri::Input_CountSiteByMonth
    params:
      dfSubjects: Mapped_SUBJ
      dfNumerator: Mapped_AE
      dfDenominator: Mapped_SUBJ
      strStudyCol: studyid
      strGroupCol: invid
      strGroupLevel: GroupLevel
      strSubjectCol: subjid
      strNumeratorDateCol: aest_dt
      strDenominatorDateCol: firstparticipantdate
      strDenominatorEndDateCol: lastparticipantdate
  - output: Analysis_Transformed
    name: gsm.studykri::Transform_CumCount
    params:
      dfInput: Analysis_Input
      vBy: 
        - StudyID
      nMinDenominator: AccrualThreshold
  - output: Analysis_Bootstrapped
    name: gsm.studykri::Analyze_StudyKRI
    params:
      dfInput: Analysis_Input
      nBootstrapReps: BootstrapReps
      seed: 42
  - output: Analysis_BootstrappedStudy
    name: gsm.studykri::Transform_CumCount
    params:
      dfInput: Analysis_Bootstrapped
      vBy:
        - StudyID
        - BootstrapRep
      nMinDenominator: AccrualThreshold
  - output: Analysis_Bounds
    name: gsm.studykri::Analyze_StudyKRI_PredictBounds
    params:
      dfInput: Analysis_BootstrappedStudy
      vBy:
        - StudyID
      nConfLevel: Threshold
  - output: Analysis_BoundsRef
    name: gsm.studykri::Analyze_StudyKRI_PredictBoundsRef
    params:
      dfInput: Analysis_Input
      dfStudyRef: Mapped_StudyRef
      nBootstrapReps: BootstrapReps
      nConfLevel: Threshold
      nMinDenominator: AccrualThreshold
      seed: 42
  - output: lAnalysis
    name: list
    params:
      ID: ID
      Analysis_Input: Analysis_Input
      Analysis_Transformed: Analysis_Transformed
      Analysis_Bootstrapped: Analysis_Bootstrapped
      Analysis_BootstrappedStudy: Analysis_BootstrappedStudy
      Analysis_Bounds: Analysis_Bounds
      Analysis_BoundsRef: Analysis_BoundsRef
