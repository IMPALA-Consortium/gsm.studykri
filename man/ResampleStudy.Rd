% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/SimulatePortfolio.R
\name{ResampleStudy}
\alias{ResampleStudy}
\title{Resample Study Data}
\usage{
ResampleStudy(
  lRaw,
  strNewStudyID,
  nSubjects = NULL,
  TargetSiteCount = NULL,
  replacement = TRUE,
  strOversamplDomain = NULL,
  vOversamplQuantileRange = c(0, 1),
  seed = NULL
)
}
\arguments{
\item{lRaw}{Named list of raw data domains (e.g., Raw_SUBJ, Raw_AE, etc.)}

\item{strNewStudyID}{Character string for the new study ID}

\item{nSubjects}{Integer number of subjects to sample. NULL (default) samples same
number as enrolled subjects in original data}

\item{TargetSiteCount}{Numeric. Approximate target number of sites in the resampled study.
If NULL (default), uses sites from sampled subjects naturally.
If specified, generates approximately N sites with weighted patient distributions.
Note: Final site count may vary as sites with zero patients are excluded.
Must be a positive integer.}

\item{replacement}{Logical indicating whether to sample with replacement (default: TRUE)}

\item{strOversamplDomain}{Character string naming a domain to use for stratified sampling.
NULL (default) samples from all enrolled subjects}

\item{vOversamplQuantileRange}{Numeric vector of length 2 with quantile range (0-1) for
oversampling. Default c(0, 1) includes all subjects}

\item{seed}{Integer seed for reproducibility. NULL (default) uses current random state}
}
\value{
Named list of resampled data domains with updated IDs
}
\description{
Creates a resampled version of a study with new subject and study IDs. Supports
stratified sampling based on domain activity (e.g., oversample patients with high
protocol deviations) and randomizes site assignments.
}
\details{
This function performs the following steps:
\enumerate{
\item Optionally filters subjects by their activity level in a specified domain
\item Samples subjects with or without replacement
\item Randomizes site assignments by shuffling invid values (or generates new sites if TargetSiteCount specified)
\item Updates all subject, study, and site IDs across all domains
\item Maintains referential integrity across domains
}

When \code{TargetSiteCount} is specified:
\itemize{
\item Generates TargetSiteCount site IDs with metadata sampled from original sites
\item Samples patient counts per site from the distribution observed in sampled subjects
\item Creates weighted site assignment: subjects are assigned to sites proportionally to sampled patient counts
\item Final site count may be less than target if some sites receive no patients through sampling
}

The function handles multiple subject ID formats:
\itemize{
\item subjid: Simple ID (e.g., "0496")
\item subjectid: Composite ID (e.g., "X1670496-113XXX")
\item subject_nsv: NSV format (e.g., "0496-113XXX")
}
}
\examples{
# Load test data
lRaw <- list(
  Raw_SUBJ = clindata::rawplus_dm,
  Raw_AE = clindata::rawplus_ae,
  Raw_SITE = clindata::ctms_site,
  Raw_STUDY = clindata::ctms_study
)

# Standard resampling
lStudy1 <- ResampleStudy(lRaw, "STUDY001", seed = 123)

# Oversample from high-AE patients (top 25\%)
lStudy2 <- ResampleStudy(
  lRaw,
  "STUDY002",
  nSubjects = 50,
  strOversamplDomain = "Raw_AE",
  vOversamplQuantileRange = c(0.75, 1.0),
  seed = 456
)

# Generate study with target of ~30 sites
lStudy3 <- ResampleStudy(
  lRaw,
  "STUDY003",
  nSubjects = 200,
  TargetSiteCount = 30,
  seed = 789
)

}
