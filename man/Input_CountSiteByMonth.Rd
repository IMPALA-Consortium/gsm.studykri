% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Input_CountSiteByMonth.R
\name{Input_CountSiteByMonth}
\alias{Input_CountSiteByMonth}
\title{Calculate Monthly Count by Site and Month}
\usage{
Input_CountSiteByMonth(
  dfSubjects,
  dfNumerator,
  dfDenominator,
  strStudyCol = "studyid",
  strGroupCol = "invid",
  strGroupLevel = "Site",
  strSubjectCol = "subjid",
  strNumeratorDateCol,
  strDenominatorDateCol,
  strDenominatorEndDateCol = NULL
)
}
\arguments{
\item{dfSubjects}{data.frame or tbl. Subject-level data with enrolled subjects.}

\item{dfNumerator}{data.frame or tbl. Event data for numerator (e.g., adverse events).}

\item{dfDenominator}{data.frame or tbl. Event data for denominator (e.g., visits).}

\item{strStudyCol}{character. Column name for study identifier (default: "studyid").}

\item{strGroupCol}{character. Column name for site identifier (default: "invid").}

\item{strGroupLevel}{character. Grouping level name (default: "Site").}

\item{strSubjectCol}{character. Column name for subject identifier (default: "subjid").}

\item{strNumeratorDateCol}{character. Date column name in numerator data.}

\item{strDenominatorDateCol}{character. Date column name in denominator data (start date).}

\item{strDenominatorEndDateCol}{character. End date column in denominator data (default: NULL). When provided, calculates sum of days between start/end dates per month instead of record counts.}
}
\value{
data.frame with columns: GroupID, GroupLevel, Numerator, Denominator, Metric, StudyID, MonthYYYYMM
}
\description{
Calculates monthly event counts and ratios by site and month for KRI analysis.
Joins subject, numerator, and denominator data to create monthly metrics.
When strDenominatorEndDateCol is provided, calculates days between start/end dates
per month instead of counting records.
Note: This function returns monthly counts, not cumulative. Cumulative aggregation
is performed at the study level in Transform_CumCount.
Supports both in-memory data frames and dbplyr lazy tables.
}
\examples{
dfSubjects <- clindata::rawplus_dm
dfNumerator <- clindata::rawplus_ae
dfDenominator <- clindata::rawplus_visdt

# Count-based calculation
result <- Input_CountSiteByMonth(
  dfSubjects = dfSubjects,
  dfNumerator = dfNumerator,
  dfDenominator = dfDenominator,
  strNumeratorDateCol = "aest_dt",
  strDenominatorDateCol = "visit_dt"
)

# Days-based calculation with end dates
result_days <- Input_CountSiteByMonth(
  dfSubjects = dfSubjects,
  dfNumerator = dfNumerator,
  dfDenominator = dfSubjects,
  strNumeratorDateCol = "aest_dt",
  strDenominatorDateCol = "firstparticipantdate",
  strDenominatorEndDateCol = "lastparticipantdate"
)

}
